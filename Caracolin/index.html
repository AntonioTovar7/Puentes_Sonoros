<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puentes Sonoros | Comunidad Auditiva</title>

    <style>
        :root {
            --primary: #8fb9a8;
            --bg-gradient: linear-gradient(135deg, #2d3e2f 0%, #1a241c 100%);
            --card-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: var(--bg-gradient);
            background-attachment: fixed;
            color: white;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 600px;
            padding: 40px 20px;
        }

        header { text-align: center; margin-bottom: 40px; }
        h1 { font-weight: 600; letter-spacing: 1px; color: var(--primary); margin-bottom: 5px; }

        /* Caja de publicación principal */
        .post-box {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 35px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        textarea {
            width: 100%;
            box-sizing: border-box;
            padding: 15px;
            border: none;
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 14px;
            resize: none;
            margin-top: 10px;
        }

        button {
            margin-top: 15px;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            background: var(--primary);
            color: #1a241c;
            cursor: pointer;
            font-weight: 700;
            transition: 0.3s;
        }

        button:hover { background: #a9d1c1; transform: scale(1.02); }

        /* Tarjetas de Post */
        .post-card {
            background: var(--card-bg);
            backdrop-filter: blur(8px);
            padding: 22px;
            border-radius: 18px;
            margin-bottom: 25px;
            border: 1px solid var(--glass-border);
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; } }

        .author { font-size: 13px; color: var(--primary); font-weight: bold; margin-bottom: 10px; display: flex; justify-content: space-between; }
        .timestamp { font-weight: normal; opacity: 0.6; font-size: 11px; }

        /* Sección de Comentarios */
        .comments-area {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--glass-border);
        }

        .comment-item {
            background: rgba(255,255,255,0.05);
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 8px;
            font-size: 13.5px;
            border-left: 3px solid var(--primary);
        }

        .comment-input-group { display: flex; gap: 10px; margin-top: 15px; }
        .comment-input-group textarea { margin-top: 0; height: 40px; padding: 8px 12px; }
        .comment-input-group button { margin-top: 0; padding: 0 15px; font-size: 12px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>PUENTES SONOROS</h1>
        <p style="opacity:0.7">Foro de Rehabilitación Auditiva</p>
    </header>

    <div class="post-box">
        <h3 style="margin:0">Comparte tu experiencia</h3>
        <textarea id="mainInput" rows="3" placeholder="Escribe aquí tu duda o consejo..."></textarea>
        <button onclick="crearPost()">Publicar en el foro</button>
    </div>

    <div id="feed">Cargando comunidad...</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyD773VY0FSgabmE9mHpj2cITkhNHYjoWtU",
        authDomain: "caracoltv-479f6.firebaseapp.com",
        projectId: "caracoltv-479f6",
        storageBucket: "caracoltv-479f6.firebasestorage.app",
        messagingSenderId: "511279307954",
        appId: "1:511279307954:web:fb944c34b90457289b7dab"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Crear un post nuevo
    function crearPost() {
        const text = document.getElementById('mainInput').value;
        if(!text.trim()) return;

        db.collection("comentarios").add({
            contenido: text,
            fecha: Date.now(),
            respuestas: [] // Array para guardar los comentarios
        }).then(() => {
            document.getElementById('mainInput').value = "";
        });
    }

    // Añadir un comentario a un post existente
    function responder(id) {
        const input = document.getElementById(`reply-${id}`);
        const text = input.value;
        if(!text.trim()) return;

        db.collection("comentarios").doc(id).update({
            respuestas: firebase.firestore.FieldValue.arrayUnion(text)
        }).then(() => {
            input.value = "";
        });
    }

    // Escucha en tiempo real
    db.collection("comentarios").orderBy("fecha", "desc").onSnapshot(snapshot => {
        const feed = document.getElementById('feed');
        feed.innerHTML = "";
        
        snapshot.forEach(doc => {
            const data = doc.data();
            const id = doc.id;
            const card = document.createElement('div');
            card.className = 'post-card';
            
            const fecha = new Date(data.fecha).toLocaleString([], { hour: '2-digit', minute: '2-digit', day: '2-digit', month: '2-digit' });

            // Generar HTML de las respuestas
            const listaRespuestas = (data.respuestas || []).map(r => `
                <div class="comment-item">${r}</div>
            `).join("");

            card.innerHTML = `
                <div class="author">
                    <span>Usuario Anónimo</span>
                    <span class="timestamp">${fecha}</span>
                </div>
                <div class="content">${data.contenido}</div>
                
                <div class="comments-area">
                    ${listaRespuestas}
                    <div class="comment-input-group">
                        <textarea id="reply-${id}" placeholder="Escribe un comentario..."></textarea>
                        <button onclick="responder('${id}')">Enviar</button>
                    </div>
                </div>
            `;
            feed.appendChild(card);
        });
    });
</script>

</body>
</html>